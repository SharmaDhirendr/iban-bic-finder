<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IBAN to BIC Finder</title>
  <meta name="description" content="Paste IBAN â†’ Get BIC instantly. Works offline. Free."/>
  <link rel="manifest" href="/manifest.json?v=2">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¸</text></svg>">
  <style>
    :root { --blue:#3b82f6; --blue-700:#2563eb; --green:#10b981; --muted:#6b7280; --border:#e5e7eb; --bg:#f9fafb; --text:#1f2937; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Inter,Arial,sans-serif; background: var(--bg); color: var(--text); padding: 1rem; line-height: 1.6; }
    .container { max-width: 520px; margin: 2rem auto; }
    h1 { font-size: 1.6rem; text-align: center; margin-bottom: .5rem; font-weight: 800; letter-spacing: .2px; }
    p.subtitle { text-align:center; color:var(--muted); font-size:.95rem; margin-bottom:1rem; }
    label { display:block; font-size:.9rem; font-weight:600; margin:.25rem 0 .4rem; }
    input {
      width: 100%; padding: 1rem; font-size: 1rem;
      border: 2px solid var(--border); border-radius: .5rem; margin-bottom:.4rem;
      transition: border-color .15s, box-shadow .15s;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }
    input:focus { outline: none; border-color: var(--blue); box-shadow: 0 0 0 3px rgba(59,130,246,.15); }
    .hint { color: var(--muted); font-size: .9rem; margin:.25rem 0 .25rem; }
    .err { display:none; color:#dc2626; font-size:.9rem; margin-top:.25rem; }
    button {
      width: 100%; padding: 1rem; background: var(--blue); color: white; border: none;
      border-radius: 0.5rem; font-weight: 700; cursor: pointer; transition: transform .12s, background .12s, box-shadow .12s;
    }
    button:hover { background: var(--blue-700); box-shadow: 0 6px 16px rgba(37,99,235,.25); transform: translateY(-1px); }
    button:active { transform: translateY(0); box-shadow: none; }
    .result {
      margin-top: 1rem; padding: 1rem; background: #ecfdf5; border: 1px solid #a7f3d0;
      border-radius: 0.5rem; display: none;
    }
    .result.show { display: block; animation: fade .15s ease-out; }
    .row { display:flex; align-items:center; gap:.5rem; margin:.35rem 0; }
    .row strong { min-width: 90px; color:#065f46; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .copy-btn {
      background: var(--green); color: #fff; border: none; padding: .45rem .75rem;
      border-radius: .375rem; cursor: pointer; font-size: .85rem; font-weight: 700; margin-left:.4rem;
      transition: filter .12s, transform .12s;
    }
    .copy-btn:hover { filter: brightness(.95); transform: translateY(-1px); }
    .copy-btn.copied { animation: pop .22s ease-out; }
    .footer { text-align:center; margin-top: 1.25rem; font-size:.875rem; color: var(--muted); }
    @keyframes fade { from { opacity:0; transform: translateY(-4px);} to {opacity:1; transform: translateY(0);} }
    @keyframes pop { from{transform:scale(.98)} to{transform:scale(1)} }
  </style>
</head>
<body>
  <div class="container">
    <h1>IBAN to BIC Finder</h1>
    <p class="subtitle">Paste IBAN â†’ Get BIC in 1 second</p>

    <label for="iban">Paste IBAN</label>
    <input type="text" id="iban" placeholder="e.g. DE89 3704 0044 0532 0130 00" autocomplete="off" autocapitalize="none" spellcheck="false" />
    <p id="hint" class="hint">No data leaves your device. Works offline after first load.</p>
    <p id="err" class="err" role="alert"></p>

    <button id="findBtn" onclick="findBIC()">Find BIC</button>

    <div id="result" class="result" aria-live="polite">
      <p class="row"><strong>BIC:</strong> <span id="bic" class="mono"></span>
        <button class="copy-btn" onclick="copy('bic', this)">Copy</button>
      </p>
      <p class="row"><strong>Bank:</strong> <span id="bank"></span></p>
      <p class="row"><strong>Country:</strong> <span id="country"></span></p>
    </div>

    <div class="footer">Offline â€¢ Free â€¢ No tracking</div>
  </div>

  <script>
    // --- Data (same logic, same keys) ---
    const bankRules = {
      "DE3704": { bic: "COBADEFFXXX", bank: "Commerzbank", country: "Germany" },
      "DE5001": { bic: "DEUTDEFFXXX", bank: "Deutsche Bank", country: "Germany" },
      "DE7001": { bic: "PBNKDEFFXXX", bank: "Postbank", country: "Germany" },
      "NL91INGB": { bic: "INGBNL2A", bank: "ING Bank", country: "Netherlands" },
      "NL91ABNA": { bic: "ABNANL2A", bank: "ABN AMRO", country: "Netherlands" },
      "FR142004": { bic: "BNPAFRPPXXX", bank: "BNP Paribas", country: "France" },
      "GB29NWBK": { bic: "NWBKGB2L", bank: "NatWest", country: "UK" },
      "ES912100": { bic: "CAIXESBBXXX", bank: "CaixaBank", country: "Spain" }
      // Add more banks here later
    };

    // --- Small helpers (non-breaking) ---
    const ibanEl   = document.getElementById("iban");
    const resultEl = document.getElementById("result");
    const errEl    = document.getElementById("err");
    const bicEl    = document.getElementById("bic");
    const bankEl   = document.getElementById("bank");
    const countryEl= document.getElementById("country");

    // Remember last IBAN for convenience
    (function restoreLast(){
      const last = localStorage.getItem('lastIBAN');
      if (last) ibanEl.value = last;
    })();
    ibanEl.addEventListener('input', () => localStorage.setItem('lastIBAN', ibanEl.value));

    // Enter to search
    ibanEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') findBIC(); });

    function showErr(msg){
      errEl.textContent = msg || '';
      errEl.style.display = msg ? 'block' : 'none';
    }
    function clearErr(){ showErr(''); }

    function looksLikeIBAN(s){
      const x = (s||'').replace(/\s+/g,'').toUpperCase();
      return /^[A-Z]{2}[0-9A-Z]{13,34}$/.test(x);
    }

    // --- Core (unchanged behavior, just tiny UX) ---
    function findBIC() {
      const inputRaw = ibanEl.value;
      const input = inputRaw.replace(/\s/g, '').toUpperCase();
      if (!input || input.length < 15 || !looksLikeIBAN(input)) {
        alert("Please enter a valid IBAN");
        showErr("Please enter a valid IBAN.");
        resultEl.classList.remove("show");
        return;
      }
      clearErr();

      const country = input.substring(0, 2);
      const bankCode = input.substring(4, 8);
      const key = country + bankCode;

      let found = null;
      for (const rule in bankRules) {
        if (rule.startsWith(key)) { found = bankRules[rule]; break; }
      }

      if (found) {
        bicEl.textContent = found.bic;
        bankEl.textContent = found.bank;
        countryEl.textContent = found.country;
        resultEl.classList.add("show");
      } else {
        alert("Bank not found. Try a major bank or add it to the code!");
        showErr("Bank not found in local list. Check your IBAN or extend bankRules.");
        resultEl.classList.remove("show");
      }
    }

    function copy(id, btn) {
      const text = document.getElementById(id).textContent;
      if (!text) return;
      navigator.clipboard.writeText(text).then(() => {
        const old = btn.textContent;
        btn.textContent = "Copied!";
        btn.classList.add("copied");
        setTimeout(() => { btn.textContent = old; btn.classList.remove("copied"); }, 900);
      }).catch(() => alert("Failed to copy. Please copy manually."));
    }

    // Register service worker for offline use (cache-busted to avoid stale)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js?v=2').catch(()=>{});
      });
    }
  </script>
</body>
</html>
